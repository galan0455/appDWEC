<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="./jquery.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
    <script>
        $(document).ready(()=>{
            pedirCoches();
            $("button").click(anadirCoche);
        });
        function anadirCoche(){
            $.post("addCoche.php",{
                "matricula": $("#matricula").val(),
                "marca": $("#marca").val(),
                "modelo": $("#modelo").val(),
                "cilindrada": $("#cilindrada").val(),
                "fecha": $("#fecha").val(),
                "foto": $("#foto").val(),
            },procesarRespuesta,"json");
        }
        function procesarRespuesta(respuesta){
            if (respuesta.estado == "ok"){
                alert("Operacion realizada con exito");
                pedirCoches();
            } else {
                alert(respuesta.mensaje)
            }
        }
        function pedirCoches(){
            $.getJSON("consultaCoches.php",{},pintarCoches)
        }
        function pintarCoches(lista){
            let tbody=document.querySelector("table tbody");
            tbody.innerHTML="";
            lista.forEach(coche => {
                contenido =`<tr>
                    <td>${coche.marca}</td>
                    <td>${coche.modelo}</td>
                    <td>${coche.cilindrada}</td>
                    <td>${coche.fecha}</td>
                    <td><img SRC="../imagenes/${coche.foto}"</td>         
                    <td><img width='50px' SRC="./papelera.png" onclick="delCoche('${coche.matricula}')"</td>                  
                    <td><img width='50px' SRC="./fotolapiz.avif" onclick="editarCoche('${coche.matricula}')"</td>                  
                    </tr>`
                tbody.innerHTML +=contenido; 
            });
        }

        function delCoche(matricula){
            $.post("delCoche.php",{
                matricula
            },procesarRespuesta,"json");
        }

        function editarCoche(matricula){
            divEdit=document.getElementById("editar");
            divEdit += `Marca
                <input type="text" id="marcaEditado">
                <br><br>
                modelo
                <input type="text" id="modeloEditado">
                <br><br>
                cilindrada
                <input type="text" id="cilindradaEditado">
                <br><br>
                fecha
                <input type="text" id="fechaEditado">
                <br><br>
                foto
                <input type="text" id="fotoEditado">

                <button type="button" id="botonEditar" onclick='confirmarEdicion()'>Edicion</button>`;
        }

    </script>
    <style>
        #nuevoCoche{
            border: 2px solid red;
            background-color: grey;
            width: 300px;
        }
    </style>
</head>
<body>
    <div id="nuevoCoche">
        <p>MATRICULA<input type="text" id="matricula"></p>
        <p>MARCA<input type="text" id="marca"></p>
        <p>MODELO<input type="text" id="modelo"></p>
        <p>CILINDRADA<input type="text" id="cilindrada"></p>
        <p>FECHA<input type="text" id="fecha"></p>
        <p>FOTO<input type="text" id="foto"></p>
        <button type="button">AÃ‘ADIR FOTO</button>
    </div>
    <table>
        <thead>
            <tr>
                <th>MARCA</th>
                <th>MODELO</th>
                <th>CILINDRADA</th>
                <th>FECHA</th>
                <th>FOTO</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <div id="editar">

    </div>
    
</body>
</html>